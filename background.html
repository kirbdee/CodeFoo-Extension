<html>
<head>
	<script src='scripts/jquery-1.6.1.min.js'></script>
	<script>

	chrome.browserAction.onClicked.addListener(function(tab) {
	chrome.tabs.executeScript(
	null, {code:"document.body.style.background='red !important'"});
	});

	

	window.setInterval(function() {
  		
  		checkLatestData(compareData);
	}, 5000);

	function checkLatestData(callback) {
		var header;
		var articlesUrl = localStorage['articlesUrl'];
		var geturl;
	  	geturl = $.ajax({
	    type: "GET",
	    url: articlesUrl,
	    success: function () {
	    	header = geturl.getAllResponseHeaders();
	    	callback.call(null, header);
			}
		});
	}

	var firstRun = 0;
	if (firstRun === 0){localStorage['badgeCount']=0;firstRun=1;}

	function compareData(latestHeader){
		latestHeaderDate = latestHeader.slice(6,31);
		if(latestHeaderDate != localStorage['latestHeaderDate']){
			alert(latestHeaderDate+"\n"+localStorage['latestHeaderDate']);
			var badgeCount = localStorage['badgeCount'];
			localStorage['latestHeaderDate'] = latestHeaderDate;
			badgeCount++;
			localStorage['badgeCount'] = badgeCount;

			chrome.browserAction.setBadgeBackgroundColor({color: [255, 0, 0, 255]});
			chrome.browserAction.setBadgeText({text:String(badgeCount)});

		}
	}

	/*
	TODO:
		Add Notifications
	*/
	</script>
</head>
<body>
</body>
</html>